<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Sync Test Suite</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: #2a2a2a;
            border: 1px solid #00ff00;
            margin: 20px 0;
            padding: 20px;
            border-radius: 5px;
        }
        .test-item {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #00ff00;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
            margin-left: 10px;
        }
        .pending { background: #ffaa00; color: #000; }
        .success { background: #00ff00; color: #000; }
        .error { background: #ff0000; color: #fff; }
        .info { background: #0066ff; color: #fff; }
        .console-output {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .instructions {
            background: #1a3a1a;
            border: 1px solid #00ff00;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .step {
            margin: 10px 0;
            padding: 10px;
            background: #2a4a2a;
            border-radius: 3px;
        }
        .highlight {
            background: #ffff00;
            color: #000;
            padding: 2px 4px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Real-time Sync Test Suite</h1>
        
        <div class="instructions">
            <h2>üìã Test Instructions</h2>
            <div class="step">
                <strong>Step 1:</strong> Open this page in <span class="highlight">Browser 1</span> (e.g., Chrome)
            </div>
            <div class="step">
                <strong>Step 2:</strong> Open this page in <span class="highlight">Browser 2</span> (e.g., Firefox)
            </div>
            <div class="step">
                <strong>Step 3:</strong> Open your app at <span class="highlight">http://localhost:3009/</span> in both browsers
            </div>
            <div class="step">
                <strong>Step 4:</strong> Follow the test checklist below, performing actions in Browser 1 and verifying sync in Browser 2
            </div>
        </div>

        <div class="test-section">
            <h2>üîß Setup Verification</h2>
            <div class="test-item">
                <strong>Console Setup Messages:</strong>
                <span class="status pending" id="setup-status">PENDING</span>
                <div class="console-output" id="setup-console">Waiting for console messages...</div>
            </div>
        </div>

        <div class="test-section">
            <h2>üë• Roster Sync Tests</h2>
            <div class="test-item">
                <strong>Add Therapist to Roster:</strong>
                <span class="status pending" id="roster-add-status">PENDING</span>
                <div>Action: Add a therapist to today's roster in Browser 1</div>
                <div>Expected: Therapist appears instantly in Browser 2</div>
            </div>
            <div class="test-item">
                <strong>Remove Therapist from Roster:</strong>
                <span class="status pending" id="roster-remove-status">PENDING</span>
                <div>Action: Remove a therapist from roster in Browser 1</div>
                <div>Expected: Therapist disappears instantly in Browser 2</div>
            </div>
            <div class="test-item">
                <strong>Check-in Therapist:</strong>
                <span class="status pending" id="roster-checkin-status">PENDING</span>
                <div>Action: Check in a therapist in Browser 1</div>
                <div>Expected: Status changes to "available" instantly in Browser 2</div>
            </div>
        </div>

        <div class="test-section">
            <h2>üö∂ Walkouts Sync Tests</h2>
            <div class="test-item">
                <strong>Add Walkout:</strong>
                <span class="status pending" id="walkout-add-status">PENDING</span>
                <div>Action: Add a walkout using side panel in Browser 1</div>
                <div>Expected: Walkout appears instantly in Browser 2</div>
            </div>
            <div class="test-item">
                <strong>Walkout Count Update:</strong>
                <span class="status pending" id="walkout-count-status">PENDING</span>
                <div>Action: Add multiple walkouts with different counts in Browser 1</div>
                <div>Expected: All walkouts sync with correct counts in Browser 2</div>
            </div>
        </div>

        <div class="test-section">
            <h2>üè† Room Availability Sync Tests</h2>
            <div class="test-item">
                <strong>Start Session (Room Occupied):</strong>
                <span class="status pending" id="room-occupied-status">PENDING</span>
                <div>Action: Start a session in Browser 1 (assigns room)</div>
                <div>Expected: Room status changes to "occupied" instantly in Browser 2</div>
            </div>
            <div class="test-item">
                <strong>Complete Session (Room Available):</strong>
                <span class="status pending" id="room-available-status">PENDING</span>
                <div>Action: Complete the session in Browser 1</div>
                <div>Expected: Room status changes to "available" instantly in Browser 2</div>
            </div>
        </div>

        <div class="test-section">
            <h2>üìä Sessions Sync Tests</h2>
            <div class="test-item">
                <strong>Create Session:</strong>
                <span class="status pending" id="session-create-status">PENDING</span>
                <div>Action: Create a new session in Browser 1</div>
                <div>Expected: Session appears in active sessions list in Browser 2</div>
            </div>
            <div class="test-item">
                <strong>Update Session Status:</strong>
                <span class="status pending" id="session-update-status">PENDING</span>
                <div>Action: Update session timing or status in Browser 1</div>
                <div>Expected: Changes reflect instantly in Browser 2</div>
            </div>
        </div>

        <div class="test-section">
            <h2>üìà Real-time Console Monitoring</h2>
            <div class="test-item">
                <strong>Live Console Output:</strong>
                <div class="console-output" id="live-console">Monitoring console for real-time updates...</div>
            </div>
        </div>

        <div class="test-section">
            <h2>‚úÖ Test Results Summary</h2>
            <div class="test-item">
                <strong>Overall Status:</strong>
                <span class="status pending" id="overall-status">PENDING</span>
                <div id="test-summary">All tests pending...</div>
            </div>
        </div>
    </div>

    <script>
        // Test tracking
        let testResults = {
            setup: false,
            rosterAdd: false,
            rosterRemove: false,
            rosterCheckin: false,
            walkoutAdd: false,
            walkoutCount: false,
            roomOccupied: false,
            roomAvailable: false,
            sessionCreate: false,
            sessionUpdate: false
        };

        // Console monitoring
        const originalLog = console.log;
        const originalError = console.error;
        const liveConsole = document.getElementById('live-console');
        let consoleOutput = '';

        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.join(' ') + '\n';
            consoleOutput += `[LOG] ${message}`;
            liveConsole.textContent = consoleOutput;
            liveConsole.scrollTop = liveConsole.scrollHeight;
            
            // Check for real-time messages
            if (message.includes('üöÄ Setting up real-time subscriptions')) {
                updateTestStatus('setup-status', 'success', 'Real-time subscriptions set up!');
                testResults.setup = true;
            }
            if (message.includes('üîÑ Real-time roster update')) {
                updateTestStatus('roster-add-status', 'success', 'Roster sync working!');
                testResults.rosterAdd = true;
            }
            if (message.includes('üîÑ Real-time walkouts update')) {
                updateTestStatus('walkout-add-status', 'success', 'Walkouts sync working!');
                testResults.walkoutAdd = true;
            }
            if (message.includes('üîÑ Real-time rooms update')) {
                updateTestStatus('room-occupied-status', 'success', 'Room sync working!');
                testResults.roomOccupied = true;
            }
            if (message.includes('üîÑ Real-time sessions update')) {
                updateTestStatus('session-create-status', 'success', 'Sessions sync working!');
                testResults.sessionCreate = true;
            }
            
            updateOverallStatus();
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            const message = args.join(' ') + '\n';
            consoleOutput += `[ERROR] ${message}`;
            liveConsole.textContent = consoleOutput;
            liveConsole.scrollTop = liveConsole.scrollHeight;
        };

        function updateTestStatus(elementId, status, message) {
            const element = document.getElementById(elementId);
            const statusSpan = element.querySelector('.status');
            statusSpan.className = `status ${status}`;
            statusSpan.textContent = status.toUpperCase();
            if (message) {
                element.innerHTML += `<div class="info">${message}</div>`;
            }
        }

        function updateOverallStatus() {
            const totalTests = Object.keys(testResults).length;
            const passedTests = Object.values(testResults).filter(Boolean).length;
            const overallStatus = document.getElementById('overall-status');
            const summary = document.getElementById('test-summary');
            
            if (passedTests === totalTests) {
                overallStatus.className = 'status success';
                overallStatus.textContent = 'ALL PASSED';
                summary.textContent = `üéâ All ${totalTests} tests passed! Real-time sync is working perfectly.`;
            } else if (passedTests > 0) {
                overallStatus.className = 'status info';
                overallStatus.textContent = 'PARTIAL';
                summary.textContent = `${passedTests}/${totalTests} tests passed. Continue testing...`;
            } else {
                overallStatus.className = 'status pending';
                overallStatus.textContent = 'PENDING';
                summary.textContent = 'No tests completed yet. Start testing...';
            }
        }

        // Auto-refresh console every 2 seconds
        setInterval(() => {
            if (consoleOutput.length > 10000) {
                consoleOutput = consoleOutput.slice(-5000);
            }
        }, 2000);

        // Instructions for manual testing
        console.log('üß™ Real-time Sync Test Suite Loaded');
        console.log('üìã Follow the test checklist above to verify real-time sync functionality');
        console.log('üîç Watch this console for real-time update messages');
        console.log('‚úÖ Mark tests as complete when you verify the sync is working');
    </script>
</body>
</html>
